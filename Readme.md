# nodoc

Generate gitHub flavored markdown API doc from source code comments.
> Oops, this doc is generated by nodoc itself !

[![NPM version](https://badge.fury.io/js/nodoc.svg)](http://badge.fury.io/js/nodoc)
[![Deps Up to Date](https://david-dm.org/dracupid/nodoc.svg?style=flat)](https://david-dm.org/dracupid/nodoc)

## Supported Languages
- CoffeeScript

> Other languagage, especially javascript, will be supported soon.

#### Language Name Alias
Use lower case, used both for language option and extname recognization.
```javascript
{
    "coffee": "coffee",
    "coffeescript": "coffee",
    "js": "javascript",
    "javascript": "javascript"
}
```

## Quick Start
```javascript
var doc = require('nodoc'),
    fs = require('fs');

doc.generate('./src/parser/index.coffee', {
    moduleName: 'parser',
    moduleDesc: 'This is a parser!'
}).then(function(markdown){
    fs.writeFileSync('./api.md', markdown);
});
```

## Comment format
Of course, you need to write your comments in a standard way to make a parser work.
Such as:
```coffeescript
###*
 * Generate formatted markdown API document from source code
 * @param  {string} srcPath Path of source code file
 * @param  {Object=} opts    Options, optional
 * @return {Promise}        Resolve formatted markdown
 * @example
 * ` ``javascript
 * nodoc.generate('./src/index.coffee').then(function(md){
 *     console.log(md);
 * });
 * ` ``
###
```
As you can see, you can use **markdown** in your comment!

> Reference: [jsdoc](http://usejsdoc.org/)

More and more tags is going to be supported.

### Predefined tags
- `@private`: Hidden in the generated document.
- `@nodoc`: Same behavior as `@private`, but they are differ in semantics.
- `@alias`: Shown as an addition of function name.
- `@prefix`: Add a custom prefix to function

## API


- #### <a href="./src/index.coffee?source#L71" target="_blank"><b>generate (alias: render ) </b></a>
  Generate formatted markdown API document from source code

  - **<u>param</u>**: `srcPath` { _string_ }

    Path of source code file

  - **<u>param</u>**: `opts` { _Object=_ }

    Options, optional
    ```javascript
    {
        moduleName: '', // module name of the file, or it will be auto set to file name, of parent directory name for `index` file.
        moduleDesc: '', // module decription
        template: '',   // custom template
        tplData: {},    // addition template data
        cwd: process.cwd()   // current working directory
        language: ''         // specify the language, or it will be auto recognized by extname
        rule: {}                // specific parser rule, items vary from parsers
    }
    ```

  - **<u>return</u>**: { _Promise_ }

    Resolve formatted markdown

  - **<u>example</u>**: 

    ```javascript
    nodoc.generate('./src/index.coffee').then(function(md){
        console.log(md);
    });
    ```

- #### <a href="./src/index.coffee?source#L101" target="_blank"><b>parser</b></a>
  Parser module, see below for details.



## Parser Module


- #### <a href="./src/parser/index.coffee?source#L23" target="_blank"><b>parser.setParser</b></a>
  Create a new parser or override an old ones

  - **<u>param</u>**: `name` { _string|Array_ }

    parser's name/language (and aliases)

  - **<u>param</u>**: `parser` { _Object_ }

    parser object, see below

- #### <a href="./src/parser/index.coffee?source#L46" target="_blank"><b>parser.parse</b></a>
  Parse source code directly.

  - **<u>param</u>**: `source` { _string_ }

    source code

  - **<u>param</u>**: `language` { _string_ }

    specify source language

  - **<u>param</u>**: `opts` { _Object=_ }

    option, optional

  - **<u>return</u>**: { _Array_ }

    parsed comments object **array**

  - **<u>example</u>**: 

    ```javascript
    nodoc.parser.parse("This is source code with comments", "coffee").then(function(comments){
        console.log(comments);
    })
    ```

- #### <a href="./src/parser/index.coffee?source#L81" target="_blank"><b>parser.parseFile</b></a>
  Parse source code from file. Use Promise instead of callback

  - **<u>param</u>**: `filePath` { _string_ }

    souce file path

  - **<u>param</u>**: `opts` { _Object=_ }

    options

  - **<u>return</u>**: { _Promise_ }

    resolve parsed comment object **array**

  - **<u>example</u>**: 

    ```javascript
    nodoc.parser.parseFile("index.coffee", {cwd: './src'}).then(function(comments){
        console.log(comments);
    });
    ```

- #### <a href="./src/parser/index.coffee?source#L89" target="_blank"><b>parser.parseFileSync</b></a>
  Synchronous version of parseFile

  - **<u>return</u>**: { _Object_ }

    parsed comment object **array**

- #### <a href="./src/parser/index.coffee?source#L104" target="_blank"><b>parser.setRule</b></a>
  Set parser's rule

  - **<u>param</u>**: `language` { _string_ }

    parser's name/language

  - **<u>param</u>**: `rule` { _Object_ }

    parser's rule object

  - **<u>example</u>**: 

    ```javascript
    nodoc.parser.setRule('coffee', {
        commentReg: /#?([\s\S]+?)#\s+([\w\.]+)/g
    });
    ```



#### Parsed Comment Object
```javascript
{   name: 'parseFile',
    description: 'Parse source code from file. Use Promise instead of callback',
    tags: [ [Object], [Object], [Object], [Object] ], // tag objects array
    lineNum: 78 
}
```
#### Tag Object
```javascript
{   tagName: 'param',
    type: 'string', // only @param, @property, @return
    name: 'srcPath', // only @param, @property
    description: 'Path of source code file'
}

```

## Write your own template
Nodoc uses [Lo-Dash template](https://lodash.com/docs#template) to render the markdown template. You need to realize that template is not HTML's privilege.   
If you don't want to use the default template, you can use your own.
```javascript
doc.generate('./src/parser/index.coffee', {
    template: 'Here is your own template'
    tplData: {}  // You can use this object to add custom data to your template
}).then(function(markdown){});
```

However, if you even want to use a alternative template engine, please use parser module directly.

## Write your own language parser
If the languages you use is not supported by nodoc, you can write your own parser. If you want your parser to be a part of nodoc, please make a pull request, it is warmly welcomed.

A parser should provide follow APIs:
### Parser API


- #### <a href="./src/parser/coffee.coffee?source#L51" target="_blank"><b>parse</b></a>
  Parse comment from source code

  - **<u>param</u>**: `source` { _string_ }

    source code

  - **<u>param</u>**: `localRule` { _Object=_ }

    optional, custom rule object, use once

  - **<u>return</u>**: { _Array_ }

    parsed comments object array

- #### <a href="./src/parser/coffee.coffee?source#L71" target="_blank"><b>setRule</b></a>
  Set the rule of the parser

  - **<u>param</u>**: `ruleObj` { _Object_ }

    rule object

- #### <a href="./src/parser/coffee.coffee?source#L77" target="_blank"><b>getRule</b></a>
  Hmm..., I'd like to use this to generate document.

  - **<u>return</u>**: { _Object_ }

    rule object



### Rule
A parser uses and is supposed to expose the rules it uses to parse the code.

#### Rule for coffee parser
```javascript
{ commentReg: /###\*([\s\S]+?)###\s+([\w\.]+)/g,
  splitReg: /^\s+\* ?@/m,
  tagNameReg: /^([\w\.]+)\s*/,
  typeReg: /^\{(.+|}?)\}\s*/,
  nameReg: /^(\w+)\s*/,
  nameTags: [ 'param', 'property' ],
  descriptionReg: /^([\s\S]*)/ }
```

### License
MIT
